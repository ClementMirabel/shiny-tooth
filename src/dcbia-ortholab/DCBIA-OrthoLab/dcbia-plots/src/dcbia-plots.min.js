var dcbiaPlots=angular.module("dcbia-plots",[]);dcbiaPlots.paths={root:"node_modules/dcbia-plots/src"};var dcbiaPlots=angular.module("dcbia-plots");dcbiaPlots.directive("boxPlotChart",["$compile","$rootScope",function(a,b){return{restrict:"E",template:'<div id="{{elementId}}" style="width:100%"></div>',scope:{height:"=height",margin:"=margin",boxdata:"=data",boxPlotTitle:"=",legendY:"=",legendX:"="},link:function(a,b,c){a.elementId=_.uniqueId("chartArea"),a.refresh=function(){function c(a){return function(b,c){for(var d=b.quartiles[0],e=b.quartiles[2],f=(e-d)*a,c=-1,g=b.length;b[++c]<d-f;);for(;b[--g]>e+f;);return[c,g]}}var d=_.find(b.children(),function(b){return b.id===a.elementId}),e=1/0,f=-(1/0);a.width=d.clientWidth;var g,h=[],i=[],j=[],k=0;a.boxdata.data.length>0&&(g=_.keys(a.boxdata.data[0]));var l=_.pluck(a.boxdata.data,"_id"),m=_.object(l,a.boxdata.data);_.each(g,function(b){if("_id"!==b&&"_rev"!==b){var c=_.map(_.pluck(a.boxdata.data,b),function(a,b){var c={key:l[b],value:a};return c});c=_.filter(c,function(a){return _.isNumber(a.value)&&!_.isNaN(a.value)}),c.length>0&&(h[k]=c,a.boxdata.normalize?(h=_.map(h,function(a){var b=_.max(_.pluck(a,"value"));return _.map(a,function(a){return a.value=a.value/b,a})}),f=1,e=0):_.each(h[k],function(a){a.value>f&&(f=a.value),a.value<e&&(e=a.value)}),k++)}});var n=d3.box().whiskers(c(1.5)).width(a.width).height(a.height);n.domain([e,f]),void 0!==a.svg&&d3.select("#"+a.elementId).select("svg").remove();var o=40,p=100,q=a.width-p,r=a.height+a.margin.top+a.margin.bottom;a.svg=d3.select(d).insert("svg").attr("id","svgImage").attr("width",q).attr("height",r).attr("class","box").append("g");var s=d3.scale.ordinal().domain(h.map(function(a,b){return b})).rangeRoundBands([0,a.width],.7,.3),t=d3.svg.axis().scale(s).orient("bottom").tickFormat(function(a,b){return j&&j[b]&&j[b][0]?j[b][0]:i[a]}),u=d3.scale.linear().domain([e,f]).range([a.height+a.margin.top,a.margin.bottom]),v=d3.svg.axis().scale(u).orient("left");a.svg.selectAll(".box").data(_.map(h,function(a){return _.pluck(a,"value")})).enter().append("g").attr("transform",function(b,c){return"translate("+(p+s(c))+","+a.margin.top+")"}).call(n.width(s.rangeBand())),a.svg.append("text").attr("x",a.width/2).attr("y",a.margin.top/2).attr("text-anchor","middle").style("font-size","18px").text(a.boxPlotTitle),a.svg.append("g").attr("class","axis").attr("transform","translate("+p+","+r+")").call(t).append("text").attr("transform","rotate(-90)").attr("x",r/2).attr("y",-p).style("text-anchor","middle").style("font-size","14px").text(a.legendY),a.svg.append("g").attr("class","axis").attr("transform","translate("+(p-o)+", 0)").call(v).append("text").style("text-anchor","middle").attr("x",q/2).attr("y",r+o).attr("dy",".71em").style("font-size","14px").text(a.legendX);for(var w=[],x=0;x<h.length;x++)for(var y=0;y<h[x].length;y++){var z={};z.index=x,z.data=h[x][y].value,z.key=h[x][y].key,w.push(z)}a.svg.selectAll("circle").data(w).enter().append("circle").attr("class","circle").attr("style","cursor: pointer;").attr("cx",function(a){return s(a.index)+s.rangeBand()/2+p}).attr("cy",function(a){return u(a.data)}).attr("r",4).attr("id",function(a){return a.uniqueId=_.uniqueId("svgCircle_"),a.uniqueId}).on("click",function(b,c){_.isFunction(a.boxdata.circleAction)&&a.boxdata.circleAction(b.key)}).append("svg:title").text(function(a){return m[a.key].patientId+": "+a.data}).transition().duration(800)},a.$watch("boxdata",function(){void 0!==a.boxdata&&a.refresh()})}}}]);var dcbiaPlots=angular.module("dcbia-plots");dcbiaPlots.directive("circlePlot",["$routeParams","$location",function(a,b){function c(a,b,c){a.plotParameters={},a.plotParameters.threshold=.01,a.plotParameters.diameter=600,a.plotParameters.tension=.85,a.plotParameters.upperValue=.44,a.plotParameters.link1="",a.plotParameters.link2="",a.positionNodes={},a.positionNodes.Left={},a.positionNodes.Right={},a.positionNodes.All={},a.positionNodes.Left.scalePointLeft=1.9,a.positionNodes.Right.scalePointRight=1.9,a.positionNodes.All.scalePointAll=2,a.positionNodes.Left.offsetXLeft=95,a.positionNodes.Right.offsetXRight=130,a.positionNodes.All.offsetXAll=85,a.positionNodes.Left.offsetYLeft=150,a.positionNodes.Right.offsetYRight=150,a.positionNodes.All.offsetYAll=110,a.scaleImgBrainTemplate={},a.scaleImgBrainTemplate.Left=80,a.scaleImgBrainTemplate.All=80,a.scaleImgBrainTemplate.Right=80,a.descriptionPlotDone=!1,a.plotID=_.uniqueId("divDiagram"),a.brainTemplateAllClass="AllPlotTemplate"+a.plotID,a.brainTemplateLeftClass="leftPlotTemplate"+a.plotID,a.brainTemplateRightClass="rightPlotTemplate"+a.plotID,a.brainTemplateImgAll="divBrainImgALL"+a.plotID,a.brainTemplateLinkAll="divBrainLinkALL"+a.plotID,a.brainTemplateImgLeft="divBrainImgLeft"+a.plotID,a.brainTemplateLinkLeft="divBrainLinkLeft"+a.plotID,a.brainTemplateImgRight="divBrainImgRight"+a.plotID,a.brainTemplateLinkRight="divBrainLinkRight"+a.plotID,a.choice={},a.choice.selection="Average",a.plotBrainTemplate=!1,a.plotBrainConnectivity=function(){a.plotView=!0;var b=a.plotData.fdt_matrix;console.log("MATRIX",b);var c=a.plotData.jsonTableDescripton;console.log("DESCRIPTION TABLE",c);var d=[],e=[];if(angular.isString(b)){for(var f=b.split("\n"),g=0;g<f.length;g++){for(var h=[],i=f[g].split("  "),j=0;j<i.length;j++)""!=i[j]&&h.push(i[j]);h.length>0&&d.push(h)}console.log(d);for(var g in d)d.length!=d[g].length&&console.log("Error dimension matrix");var k=[];for(var l in d){var m=0;for(var n in d[l])m+=parseFloat(d[l][n]);k.push(m)}for(var l in d){var o=[];for(var n in d[l])o.push(parseFloat(d[l][n])/k[l]);e.push(o)}}else e=b;for(var p=[],q=[],r=[],s=0,l=0;l<e.length;l++)q.push({});for(var t in c){var u=c[t].MatrixRow;if("-1"!=u){q[u-1]=c[t].VisuHierarchy+c[t].name;var v=c[t].VisuOrder;v>s&&(s=v),p.push(c[t])}}for(var l=0;l<s;l++)r.push("");for(var t in p){var w=p[t].VisuOrder;if("-1"!=w){var x=p[t].VisuHierarchy+p[t].name;if(void 0!=p[t].coord)var y=p[t].coord[0],z=p[t].coord[1],A=p[t].coord[2],B={name:x,x:y,y:z,z:A};else var B={name:x};r[w-1]=B}}var C=[];e.forEach(function(a,b){var c=q.indexOf(r[b].name);if(c!=-1){var d=e[c],f=[];d.forEach(function(a,b){var c=q.indexOf(r[b].name);c!=-1&&f.push(d[c])}),C.push(f)}}),console.log("Matrix ordered"),console.log(C.length);var D={matrix:C,listOrdered:r};return D},a.resetCoord=function(){a.positionNodes.Left.scalePointLeft=1.9,a.positionNodes.Right.scalePointRight=1.9,a.positionNodes.All.scalePointAll=2,a.positionNodes.Left.offsetXLeft=95,a.positionNodes.Right.offsetXRight=130,a.positionNodes.All.offsetXAll=85,a.positionNodes.Left.offsetYLeft=150,a.positionNodes.Right.offsetYRight=150,a.positionNodes.All.offsetYAll=110,a.scaleImgBrainTemplate.Left=80,a.scaleImgBrainTemplate.All=80,a.scaleImgBrainTemplate.Right=80},a.AverageMatrix=function(a){var b=[];return a.forEach(function(c,d){var e=[];c.forEach(function(b,c){if(d==c)e.push(0);else if(c>d){var f;f=(a[d][c]+a[c][d])/2,e.push(f)}else e.push(-1)}),b.push(e)}),b},a.MaximumMatrix=function(a){var b=[];return a.forEach(function(c,d){var e=[];c.forEach(function(b,c){if(d==c)e.push(0);else if(c>d){var f;f=a[d][c]>a[c][d]?a[d][c]:a[c][d],e.push(f)}else e.push(-1)}),b.push(e)}),b},a.MinimumMatrix=function(a){var b=[];return a.forEach(function(c,d){var e=[];c.forEach(function(b,c){if(d==c)e.push(0);else if(c>d){var f;f=a[d][c]<a[c][d]?a[d][c]:a[c][d],e.push(f)}else e.push(-1)}),b.push(e)}),b},a.CreateDescription=function(b,c){if(console.log(a.plotData),a.plotData){console.log("valueCheck"+c);var d=b.matrix,e=[];e="Average"==c?a.AverageMatrix(d):"Maximum"==c?a.MaximumMatrix(d):a.MinimumMatrix(d);for(var f=b.listOrdered,g=[],h=f.length,i=0;i<h;i++){for(var j={name:f[i].name},k=[],l=[],m=0;m<h;m++)m!=i&&e[i][m]>"0"&&(k.push(parseFloat(e[i][m])),l.push(f[m]));j.size=k,j.imports=l,g.push(j)}return a.descriptionPlotDone=!0,g}},a.NewPlot=function(b,c,d){a.plotData&&(a.removeOldPlot(),a.plotVisible=!0,a.Plot())},a.removeOldPlot=function(){console.log("REMOVE");var b=document.getElementById("divPlot_"+a.plotID);null!=b&&b.parentNode.removeChild(b);var c=document.getElementById("tooltip_"+a.plotID);null!=c&&c.parentNode.removeChild(c);var d=document.getElementById("nodeTooltip_"+a.plotID);null!=d&&d.parentNode.removeChild(d);var e=document.getElementById(a.brainTemplateImgAll);null!=e&&e.parentNode.removeChild(e);var f=document.getElementById(a.brainTemplateLinkAll);null!=f&&f.parentNode.removeChild(f);var g=document.getElementById(a.brainTemplateImgRight);null!=g&&g.parentNode.removeChild(g);var h=document.getElementById(a.brainTemplateLinkRight);null!=h&&h.parentNode.removeChild(h);var i=document.getElementById(a.brainTemplateImgLeft);null!=i&&i.parentNode.removeChild(i);var j=document.getElementById(a.brainTemplateLinkLeft);null!=j&&j.parentNode.removeChild(j)},a.Plot=function(){var b=a.plotBrainConnectivity();a.removeOldPlot();var c=a.choice.selection;console.log(c+" method");var d=a.CreateDescription(b,c);if(1==a.descriptionPlotDone){var e=a.plotParameters.threshold,f=a.plotParameters.diameter,g=a.plotParameters.tension,h=a.plotParameters.upperValue;0!=h&&h<=e&&alert("The maximum upper value should be superior to the threshold value"),a.plotVisible=!0;var i=f/2,j=i-120,k=d3.layout.cluster().size([360,j]).sort(null).value(function(a){return a.size}),l=d3.layout.bundle(),m=d3.svg.line.radial().interpolate("bundle").tension(g).radius(function(a){return a.y}).angle(function(a){return a.x/180*Math.PI}),n=d3.select("#"+a.plotID).append("div").attr("class","tooltip").attr("id","tooltip_"+a.plotID).style("opacity",0),o={top:30,right:10,bottom:15,left:50},p=100-o.right-o.left,q=f,r=parseInt(f)+50,s=r+100,t=o.bottom,u=r+t,v=d3.select("#"+a.plotID).append("div").attr("width",s).attr("height",u).attr("class","divPlot").attr("id","divPlot_"+a.plotID),w=[],x=v.append("svg").attr("width",r).attr("height",u).attr("class","circlePlot").attr("id","circlePlot").append("g").attr("transform","translate("+i+","+i+")"),y=d3.scale.linear().range([q/2,0]).domain([e,h]),z=v.append("svg").attr("width",100).attr("height",u+10).attr("id","colorBar").attr("class","colorBar").append("g").attr("transform","translate("+o.left+","+u/4+")"),A=z.append("defs").append("linearGradient").attr("id","gradient"+a.plotID).attr("x1","0%").attr("y1","100%").attr("x2","0%").attr("y2","0%").attr("spreadMethod","pad");A.append("stop").attr("offset","0%").attr("stop-color",d3.hsl(240,1,.5)).attr("stop-opacity",1),A.append("stop").attr("offset","25%").attr("stop-color",d3.hsl(180,1,.5)).attr("stop-opacity",1),A.append("stop").attr("offset","50%").attr("stop-color",d3.hsl(120,1,.5)).attr("stop-opacity",1),A.append("stop").attr("offset","75%").attr("stop-color",d3.hsl(60,1,.5)).attr("stop-opacity",1),A.append("stop").attr("offset","100%").attr("stop-color",d3.hsl(0,1,.5)).attr("stop-opacity",1);"gradient"+a.plotID;z.append("rect").attr("class","grid-background").attr("width",p/1.5).attr("height",q/2).style("fill","url(#gradient"+a.plotID+")"),z.append("g").attr("class","axis").call(d3.svg.axis().scale(y).orient("left").ticks(10));var B=k.nodes(a.packageHierarchy(d)),C=a.packageImports(B,e);w=l(C);var D=a.sizeMap(B,e),E=f/35,F=h-e,G=a.plotParameters.link1,H=a.plotParameters.link2;x.selectAll(".link").data(w).enter().append("path").attr("class","link").attr("stroke-width",function(a,b){return D[b]*E+F+"px"}).attr("stroke",function(b,c){return D[c]>=h?a.colorHSV("max",0,1):a.colorHSV(D[c],e,h)}).attr("d",m).on("mouseover",function(b,c){var d=b.length;G=b[0].key+a.plotID,H=b[d-1].key+a.plotID;var e=document.getElementById(G),f=document.getElementById(H);e.setAttribute("font-weight","bold"),f.setAttribute("font-weight","bold"),e.setAttribute("font-size","13px"),f.setAttribute("font-size","13px"),n.transition().duration(200).style("opacity",.9),n.html("Connectivity value : "+D[c].toFixed(5)).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+28+"px")}).on("mouseout",function(b){var c=b.length;G=b[0].key+a.plotID,H=b[c-1].key+a.plotID;var d=document.getElementById(G),e=document.getElementById(H);d.setAttribute("font-weight","normal"),e.setAttribute("font-weight","normal"),d.setAttribute("font-size","11px"),e.setAttribute("font-size","11px"),n.transition().duration(500).style("opacity",0)});if(x.selectAll(".node").data(B.filter(function(a){return!a.children})).enter().append("g").attr("class","node").attr("transform",function(a){return"rotate("+(a.x-90)+")translate("+a.y+")"}).append("text").attr("id",function(b){return b.key+a.plotID}).attr("dx",function(a){return a.x<180?8:-8}).attr("dy",".31em").attr("text-anchor",function(a){return a.x<180?"start":"end"}).attr("transform",function(a){return a.x<180?null:"rotate(180)"}).text(function(a){return a.key}).attr("font-weight",function(a){return a.key==H?"bold":"normal"}),d3.select(self.frameElement).style("height",f+"px"),void 0!=b.listOrdered[1].x){a.plotBrainTemplate=!0;var I=d3.select("."+a.brainTemplateAllClass).append("div").attr("class","divBrainImgALL").attr("id",a.brainTemplateImgAll),J=d3.select("."+a.brainTemplateAllClass).append("div").attr("class","divBrainLinkALL").attr("id",a.brainTemplateLinkAll),K=J.append("svg").attr("id","linksTemplate").attr("width",350).attr("height",420),L=a.scaleImgBrainTemplate.All+"%";console.log("scaleImgAll",L);var M=(I.append("img").attr("src","data/rsz_brainall.png").attr("class","bgimgAll").attr("id","bgimgAll").attr("width",L),K.append("defs").append("radialGradient").attr("id","blueCircle"+a.plotID).attr("gradientUnits","objectBoundingBox").attr("fx","30%").attr("fy","30%"));M.append("stop").attr("offset","0%").attr("stop-color","#FFFFFF"),M.append("stop").attr("offset","40%").attr("stop-color","#AA0000"),M.append("stop").attr("offset","100%").attr("stop-color","#660000");var N=d3.select("#"+a.plotID).append("div").attr("class","nodeTooltip").attr("id","nodeTooltip_"+a.plotID).style("opacity",0),O=b.listOrdered,P=d3.svg.line().interpolate("bundle").tension(g).x(function(a){return a.x}).y(function(a){return a.y});w.forEach(function(b,c){var d,f,g,i,j=b.length,k=b[0].key,l=b[j-1].key;O.forEach(function(b,c){var e=b.name.lastIndexOf("."),h=b.name.substring(e+1);h==k?(d=b.x+parseFloat(a.positionNodes.All.offsetXAll),d*=parseFloat(a.positionNodes.All.scalePointAll),g=-b.y,g+=parseFloat(a.positionNodes.All.offsetYAll),g*=parseFloat(a.positionNodes.All.scalePointAll)):h==l&&(f=b.x+parseFloat(a.positionNodes.All.offsetXAll),f*=parseFloat(a.positionNodes.All.scalePointAll),i=-b.y,i+=parseFloat(a.positionNodes.All.offsetYAll),i*=parseFloat(a.positionNodes.All.scalePointAll))});var m=[{x:d,y:g},{x:f,y:i}],n=10;K.append("path").attr("d",P(m)).attr("stroke",function(){return D[c]>=h?a.colorHSV("max",0,1):a.colorHSV(D[c],e,h)}).attr("stroke-width",function(){return D[c]*n+"px"}).attr("fill","none")}),O.forEach(function(b,c){var d=b.x+parseFloat(a.positionNodes.All.offsetXAll),e=-b.y;e+=parseFloat(a.positionNodes.All.offsetYAll),K.append("circle").attr("cx",d*parseFloat(a.positionNodes.All.scalePointAll)).attr("cy",e*parseFloat(a.positionNodes.All.scalePointAll)).attr("r",4).style("fill","url(#blueCircle"+a.plotID+")").on("mouseover",function(a,c){N.transition().duration(200).style("opacity",.9);var d=b.name.lastIndexOf("."),e=b.name.substring(d+1);N.html("Seed : "+e).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px")}).on("mouseout",function(a){N.transition().duration(500).style("opacity",0)})});var Q=d3.select("."+a.brainTemplateLeftClass).append("div").attr("class","divBrainImgLeft").attr("id",a.brainTemplateImgLeft),R=d3.select("."+a.brainTemplateLeftClass).append("div").attr("class","divBrainLinkLeft").attr("id",a.brainTemplateLinkLeft),S=R.append("svg").attr("id","linksTemplate").attr("width",410).attr("height",400),T=a.scaleImgBrainTemplate.Left+"%";Q.append("img").attr("src","data/rsz_brainleft.jpg").attr("class","bgimgLeft").attr("id","bgimgLeft").attr("width",T);w.forEach(function(b,c){var d=b.length,f=b[0].key,g=b[d-1].key,i=0,j=0,k=0,l=0,m=f.lastIndexOf("_"),n=f.substring(m+1),o=g.lastIndexOf("_"),p=g.substring(o+1);if("L"==n&&"L"==p){O.forEach(function(b,c){var d=b.name.lastIndexOf("."),e=b.name.substring(d+1);e==f?(i=parseFloat(-b.y)+parseFloat(a.positionNodes.Left.offsetXLeft),i*=parseFloat(a.positionNodes.Left.scalePointLeft),k=parseFloat(-b.z)+parseFloat(a.positionNodes.Left.offsetYLeft),k*=parseFloat(a.positionNodes.Left.scalePointLeft)):e==g&&(j=parseFloat(-b.y),j+=parseFloat(a.positionNodes.Left.offsetXLeft),j*=parseFloat(a.positionNodes.Left.scalePointLeft),l=parseFloat(-b.z),l+=parseFloat(a.positionNodes.Left.offsetYLeft),l*=parseFloat(a.positionNodes.Left.scalePointLeft))});var q=[{x:i,y:k},{x:j,y:l}],r=10;S.append("path").attr("d",P(q)).attr("stroke",function(){return D[c]>=h?a.colorHSV("max",0,1):a.colorHSV(D[c],e,h)}).attr("stroke-width",function(){return D[c]*r+"px"}).attr("fill","none")}}),O.forEach(function(b,c){var d=(b.name,b.name.lastIndexOf("_")),e=b.name.substring(d+1);if("L"==e){var f=parseFloat(-b.y),f=f+parseFloat(a.positionNodes.Left.offsetXLeft),g=parseFloat(-b.z);g+=parseFloat(a.positionNodes.Left.offsetYLeft);var h=f*parseFloat(a.positionNodes.Left.scalePointLeft),i=g*parseFloat(a.positionNodes.Left.scalePointLeft);S.append("circle").attr("cx",h).attr("cy",i).attr("r",4).style("fill","url(#blueCircle"+a.plotID+")").on("mouseover",function(a,c){N.transition().duration(200).style("opacity",.9);var d=b.name.lastIndexOf("."),e=b.name.substring(d+1);N.html("Seed : "+e).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px")}).on("mouseout",function(a){N.transition().duration(500).style("opacity",0)})}});var U=d3.select("."+a.brainTemplateRightClass).append("div").attr("class","divBrainImgRight").attr("id",a.brainTemplateImgRight),V=d3.select("."+a.brainTemplateRightClass).append("div").attr("class","divBrainLinkRight").attr("id",a.brainTemplateLinkRight),W=V.append("svg").attr("id","linksTemplate").attr("width",410).attr("height",400),X=a.scaleImgBrainTemplate.Right+"%";U.append("img").attr("src","data/rsz_brainright.jpg").attr("class","bgimgRight").attr("id","bgimgRight").attr("width",X);w.forEach(function(b,c){var d,f,g,i,j=b.length,k=b[0].key,l=b[j-1].key,m=k.lastIndexOf("_"),n=k.substring(m+1),o=l.lastIndexOf("_"),p=l.substring(o+1);if("R"==n&&"R"==p){O.forEach(function(b,c){var e=b.name.lastIndexOf("."),h=b.name.substring(e+1);h==k?(d=b.y,d+=parseFloat(a.positionNodes.Right.offsetXRight),d*=parseFloat(a.positionNodes.Right.scalePointRight),g=-b.z,g+=parseFloat(a.positionNodes.Right.offsetYRight),g*=parseFloat(a.positionNodes.Right.scalePointRight)):h==l&&(f=b.y,f+=parseFloat(a.positionNodes.Right.offsetXRight),f*=parseFloat(a.positionNodes.Right.scalePointRight),i=-b.z,i+=parseFloat(a.positionNodes.Right.offsetYRight),i*=parseFloat(a.positionNodes.Right.scalePointRight))});var q=[{x:d,y:g},{x:f,y:i}],r=10;W.append("path").attr("d",P(q)).on().attr("stroke",function(){return D[c]>=h?a.colorHSV("max",0,1):a.colorHSV(D[c],e,h)}).attr("stroke-width",function(){return D[c]*r+"px"}).attr("fill","none")}}),O.forEach(function(b,c){var d=(b.name,b.name.lastIndexOf("_")),e=b.name.substring(d+1);if("R"==e){var f=b.y,f=f+parseFloat(a.positionNodes.Right.offsetXRight),g=-b.z;g+=parseFloat(a.positionNodes.Right.offsetYRight),W.append("circle").attr("cx",f*parseFloat(a.positionNodes.Right.scalePointRight)).attr("cy",g*parseFloat(a.positionNodes.Right.scalePointRight)).attr("r",4).style("fill","url(#blueCircle"+a.plotID+")").on("mouseover",function(a,c){N.transition().duration(200).style("opacity",.9);var d=b.name.lastIndexOf("."),e=b.name.substring(d+1);N.html("Seed : "+e).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px")}).on("mouseout",function(a){N.transition().duration(500).style("opacity",0)})}})}else a.plotBrainTemplate=!1}},a.colorHSV=function(a,b,c){if("max"==a)var d=d3.hsl(0,1,.5);else var e=c-b,f=a-b,g=f/e,h=240*g,d=d3.hsl(240-h,1,.5);return d},a.sizeMap=function(a,b){var c=[];return a.forEach(function(a){a.size&&a.size.forEach(function(a){a>b&&c.push(a)})}),c},a.packageHierarchy=function(a){function b(a,d){var e,f=c[a];return f||(f=c[a]=d||{name:a,children:[]},a.length&&(f.parent=b(a.substring(0,e=a.lastIndexOf("."))),f.parent.children.push(f),f.key=a.substring(e+1))),f}var c={};return a.forEach(function(a){b(a.name,a)}),c[""]},a.packageImports=function(a,b){var c={},d=[];return a.forEach(function(a){c[a.name]=a}),a.forEach(function(a){a.imports&&a.imports.forEach(function(e,f){a.size[f]>b&&d.push({source:c[a.name],target:c[e.name]})})}),d},a.$watch("scaleImgBrainTemplate.All",function(){console.log("HelloWatch scale all brain template",a.scaleImgBrainTemplate.All),a.NewPlot()}),a.$watch("scaleImgBrainTemplate.Left",function(){console.log("HelloWatch scale left brain template",a.scaleImgBrainTemplate.Left),a.NewPlot()}),a.$watch("scaleImgBrainTemplate.Right",function(){console.log("HelloWatch scale right brain template",a.scaleImgBrainTemplate.Right),a.NewPlot()}),a.$watch("positionNodes.Left.scalePointLeft",function(){console.log("HelloWatch scaleLeft",a.positionNodes.Left.scalePointLeft),a.NewPlot()}),a.$watch("positionNodes.Left.offsetXLeft",function(){console.log("HelloWatch offsetXLeft",a.positionNodes.Left.offsetXLeft),a.NewPlot()}),a.$watch("positionNodes.Left.offsetYLeft",function(){console.log("HelloWatch offsetYLeft",a.positionNodes.Left.offsetYLeft),a.NewPlot()}),a.$watch("positionNodes.All.scalePointAll",function(){console.log("HelloWatch scaleAll",a.positionNodes.All.scalePointAll),a.NewPlot()}),a.$watch("positionNodes.All.offsetXAll",function(){console.log("HelloWatch offsetXAll",a.positionNodes.All.offsetXAll),a.NewPlot()}),a.$watch("positionNodes.All.offsetYAll",function(){console.log("HelloWatch offsetYAll",a.positionNodes.All.offsetYAll),a.NewPlot()}),a.$watch("positionNodes.Right.scalePointRight",function(){console.log("HelloWatch scaleRight",a.positionNodes.Right.scalePointRight),a.NewPlot()}),a.$watch("positionNodes.Right.offsetXRight",function(){console.log("HelloWatch offsetXRight",a.positionNodes.Right.offsetXRight),a.NewPlot()}),a.$watch("positionNodes.Right.offsetYRight",function(){console.log("HelloWatch offsetYRight",a.positionNodes.Right.offsetYRight),a.NewPlot()}),a.$watch("plotParameters.link1",function(){console.log("HelloWatch link1",a.plotParameters.link1),a.NewPlot()}),a.$watch("plotParameters.link2",function(){console.log("HelloWatch link2",a.plotParameters.link2),a.NewPlot()}),a.$watch("plotParameters.threshold",function(){console.log("HelloWatch thres",a.plotParameters.threshold),a.NewPlot()}),a.$watch("plotParameters.diameter",function(){console.log("HelloWatch diam",a.plotParameters.diameter),a.NewPlot()}),a.$watch("plotParameters.tension",function(){console.log("HelloWatch tension",a.plotParameters.tension),a.NewPlot()}),a.$watch("plotParameters.upperValue",function(){console.log("HelloWatch upper",a.plotParameters.upperValue),a.NewPlot()}),a.$watch("choice.selection",function(){console.log("HelloWatch choiceSelection",a.choice.selection),a.NewPlot()}),a.$watch("plotData",function(){a.plotData&&(a.plotParameters.plotData=a.plotData,a.Plot())})}return{restrict:"E",scope:{plotData:"="},link:c,templateUrl:dcbiaPlots.paths.root+"circlePlot.template.html"}}]);var dcbiaPlots=angular.module("dcbia-plots");dcbiaPlots.directive("d3Plots",["$routeParams","$location","$rootScope","clusterauth","dcbia",function(a,b,c,d,e){function f(a,b){function c(b,c,d){b&&(a.compareTwoVariables={},a.compareTwoVariables.data=b,a.compareTwoVariables.carac1=c,a.compareTwoVariables.carac2=d)}a.elementId=_.uniqueId("d3Plots"),b.attr("id",a.elementId),a.graph={axis:{}},a.boxplotdata={},a.height=600,a.margin={left:80,right:80,top:40,bottom:40},a.update=function(){},a.$watch("data",function(){a.data&&a.update()}),a.$watch("graph.axis.x",function(){var d=a.data;void 0!=a.svg&&0==a.graph.type&&void 0!=b.children()[2]&&b.children()[2].remove(),void 0!=a.graph.axis.x&&void 0!=a.graph.axis.y&&c(d,a.graph.axis.x,a.graph.axis.y)}),a.$watch("graph.axis.y",function(){var d=a.data;void 0!=a.svg&&0==a.graph.type&&void 0!=b.children()[2]&&b.children()[2].remove(),void 0!=a.graph.axis.x&&void 0!=a.graph.axis.y&&c(d,a.graph.axis.x,a.graph.axis.y)}),a.$watch("graph.type",function(){var d=a.data,e={};_.each(d,function(a){_.extend(e,a)}),delete e._id,delete e._rev,delete e.type,a.keys=_.map(_.keys(e),function(a,b){return{id:b,label:a}}),void 0!=a.svg&&(0==a.graph.type&&void 0!=b.children()[2]&&b.children()[2].remove(),1==a.graph.type&&void 0!=b.children()[1]&&b.children()[1].remove()),0==a.graph.type?void 0!=a.graph.axis.x&&void 0!=a.graph.axis.y&&c(d,a.graph.axis.x.label,a.graph.axis.y.label):a.displayAllCaracteristics(d)}),a.circleAction=function(b){_.find(a.boxplotdata.data,function(a){return a._id===b})},a.getMorphologicalDataByPatientId=function(b){e.getMorphologicalDataByPatientId(b).then(function(b){a.attachments={},a.attachments.data=_.flatten(_.map(b.data,function(a){return _.map(a._attachments,function(b,c){return{id:a._id,label:c}})}))})},a.displayAllCaracteristics=function(b){b&&(a.boxplotdata={},a.boxplotdata.data=b,a.boxplotdata.normalize=a.graph.normalize,a.boxplotdata.circleAction=a.circleAction)},a.$watch("graph.normalize",function(){a.displayAllCaracteristics(a.data)}),a.$watch("attachments.selected",function(){a.attachments&&a.attachments.selected&&e.getAttachement(a.attachments.selected.id,a.attachments.selected.label,"arraybuffer").then(function(b){a.attachments.surface=b.data})}),a.multiSeries={subjects:{},selectedVariables:{}},a.multiSeries.addSubjects=function(b){void 0===a.multiSeries.subjects&&(a.multiSeries.subjects={}),_.each(b,function(b){a.multiSeries.subjects[b._id]=!0})},a.multiSeries.addVariables=function(b){_.each(b,function(b){a.multiSeries.selectedVariables[b.label]=!0})},a.multiSeries.update=function(){var b=_.compact(_.map(a.multiSeries.selectedVariables,function(a,b){if(a)return b})),c=_.map(b,function(b){var c={};return _.each(a.multiSeries.subjects,function(d,e){if(d){var f=_.find(a.data,function(a){return e===a._id});c[f.patientId]=f[b]}}),c});a.multiSeries.data={},a.multiSeries.data.lines=_.compact(c),a.multiSeries.data.labels=b,a.multiSeries.data.action=a.getMorphologicalDataByPatientId}}return{restrict:"E",link:f,scope:{data:"="},templateUrl:dcbiaPlots.paths.root+"d3Plots.template.html"}}]);